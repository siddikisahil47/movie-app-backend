{% extends "base.html" %}

{% block title %}Movie Collection - Movies{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold mb-8 text-center">Movie Collection</h1>
    
    <!-- Search and Filter -->
    <div class="bg-white p-4 rounded-lg shadow-md mb-6">
        <input type="text" id="movieFilter" 
               class="w-full p-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-400"
               placeholder="Filter movies...">
    </div>

    <!-- Movies Table -->
    <div class="bg-white rounded-lg shadow-md overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Year</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Runtime</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Added</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="moviesList">
                    <tr>
                        <td colspan="4" class="px-6 py-4 text-center text-gray-500">Loading movies...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
async function loadMovies() {
    try {
        const response = await fetch('/movies/data');
        const data = await response.json();
        
        if (data.error) {
            document.getElementById('moviesList').innerHTML = `
                <tr><td colspan="4" class="px-6 py-4 text-center text-red-500">Error: ${data.error}</td></tr>
            `;
            return;
        }

        if (!data.movies || data.movies.length === 0) {
            document.getElementById('moviesList').innerHTML = `
                <tr><td colspan="4" class="px-6 py-4 text-center text-gray-500">No movies found</td></tr>
            `;
            return;
        }

        renderMovies(data.movies);
    } catch (error) {
        document.getElementById('moviesList').innerHTML = `
            <tr><td colspan="4" class="px-6 py-4 text-center text-red-500">Error loading movies: ${error.message}</td></tr>
        `;
    }
}

function renderMovies(movies) {
    const moviesList = document.getElementById('moviesList');
    moviesList.innerHTML = movies.map(movie => `
        <tr class="hover:bg-gray-50">
            <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm font-medium text-gray-900">${movie.title}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-500">${movie.year || 'N/A'}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-500">${movie.runtime || 'N/A'}</div>
            </td>
            <td class="px-6 py-4 whitespace-nowrap">
                <div class="text-sm text-gray-500">${new Date(movie.created_at).toLocaleDateString()}</div>
            </td>
        </tr>
    `).join('');
}

// Filter functionality
document.getElementById('movieFilter').addEventListener('input', function(e) {
    const filter = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('#moviesList tr');
    
    rows.forEach(row => {
        const title = row.querySelector('td:first-child')?.textContent.toLowerCase();
        if (title) {
            row.style.display = title.includes(filter) ? '' : 'none';
        }
    });
});

// Load movies when page loads
loadMovies();
</script>
{% endblock %} 